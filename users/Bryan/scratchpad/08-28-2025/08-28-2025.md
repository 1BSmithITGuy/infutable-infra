# 08-28-2025

## Inbox

### Need to deal with:
bootstrap password in there?  
labels/naming conventions - see notes on monitoring
cluster:us103kubeadm01 (not kubeadm01)
Do I want it just to be rancher.infutable.com, grafana.infutable.com, etc?  And when do I want to do something like infutable.com/apps instead?  I think the infracomponents should be their own hostname I guess, so argocd and rancher and grafana should not be a subdirectroy (or whatever it is called) of infutable?   Only the small little apps?


#  documentation
need:

## removal process - see questions:

NEED to note in the documentation that Rancher is a more permanent deployment than other apps I think?  Also, I fear that some of these 

```bash
helm uninstall rancher -n cattle-system

#  the below command removed many, but not all, CRDs and hung because of finalizers:
kubectl get crd | grep cattle.io | awk '{print $1}' | xargs kubectl delete crd

# instead of above, I tried Force delete with no grace period; this still hung, didn't remove a single one:
kubectl get crd | grep cattle.io | awk '{print $1}' | xargs -I {} kubectl delete crd {} --force --grace-period=0

#---start:  CRD removal issue solution----------------------------------------
# Get list of stuck CRDs
STUCK_CRDS=$(kubectl get crd | grep cattle.io | awk '{print $1}')

for crd in $STUCK_CRDS; do
  echo "Removing finalizers from $crd"
  kubectl patch crd "$crd" -p '{"metadata":{"finalizers":[]}}' --type=merge
done
    #  questions:  
    # 1. couldn't I simply remove these finalizers on all cattle.io CRDs with the loop then run the below delete command?  Or will it error out if there are no finalizers?
        #  kubectl get crd | grep cattle.io | awk '{print $1}' | xargs kubectl delete crd

#---end: crd removal issue solution----------------------------------------

# I checked for these and don't see anything here, so I didn't do the full delete command; I think we can leave these steps out of removal steps documentation:
        kubectl get crd | grep rancher.io 
        kubectl get crd | grep fleet.cattle.io 
        kubectl get crd | grep management.cattle.io
        kubectl get crd | grep project.cattle.io

```
Before reboot:
```NAME                                     STATUS        AGE
argocd                                   Active        6d19h
cattle-fleet-clusters-system             Terminating   18h
cattle-fleet-local-system                Terminating   18h
cattle-fleet-system                      Active        18h
cattle-global-data                       Active        18h
cattle-impersonation-system              Active        18h
cattle-provisioning-capi-system          Active        18h
cattle-system                            Terminating   18h
cattle-ui-plugin-system                  Active        18h
cert-manager                             Active        18d
cluster-fleet-local-local-1a3d67d0a899   Active        18h
default                                  Active        58d
fleet-default                            Active        18h
fleet-local                              Active        18h
ingress-nginx                            Active        18d
kube-node-lease                          Active        58d
kube-public                              Active        58d
kube-system                              Active        58d
local                                    Active        18h
local-path-storage                       Active        25d
monitoring                               Active        2d21h
p-bg7gk                                  Active        18h
p-pmm7s                                  Active        18h
us103-demos                              Active        16d
user-pnmfr                               Active        115m
```


cluster: Cluster identifier (us103-kubeadm01, us103-k3s01)
site_code: Physical location (us103)
provider: Infrastructure provider (on-prem, aws, azure)
node_type: Node role (master, worker)

## Notes

Can't I just have a script with this in it and also that adds the repo?  THere is too much in the deploy script. 

helm upgrade rancher rancher-latest/rancher \
  --namespace cattle-system \
  --version 2.12.0 \
  --set hostname=rancher.us103kubeadm01.infutable.com \
  --set bootstrapPassword=infUtableR@ncher2024! \
  --set ingress.tls.source=rancher \
  --set ingress.ingressClassName=nginx \
  --set letsEncrypt.email=admin@infutable.com \
  --set letsEncrypt.environment=staging

  ## WHat I have run to troubleshoot removing rancher so far:

```
  ┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $helm uninstall rancher -n cattle-system
Error: uninstallation completed with 1 error(s): 1 error occurred:
	* job rancher-post-delete failed: BackoffLimitExceeded


┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get pods -n cattle-system --watch
^C┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get pods -n cattle-system
No resources found in cattle-system namespace.
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep cattle.io
amazonec2configs.rke-machine-config.cattle.io                     2025-08-28T00:26:33Z
amazonec2machines.rke-machine.cattle.io                           2025-08-28T00:26:33Z
amazonec2machinetemplates.rke-machine.cattle.io                   2025-08-28T00:26:33Z
apiservices.management.cattle.io                                  2025-08-28T00:26:10Z
apps.catalog.cattle.io                                            2025-08-28T00:26:10Z
auditpolicies.auditlog.cattle.io                                  2025-08-28T00:26:09Z
authconfigs.management.cattle.io                                  2025-08-28T00:26:12Z
azureconfigs.rke-machine-config.cattle.io                         2025-08-28T00:26:32Z
azuremachines.rke-machine.cattle.io                               2025-08-28T00:26:32Z
azuremachinetemplates.rke-machine.cattle.io                       2025-08-28T00:26:32Z
bundledeployments.fleet.cattle.io                                 2025-08-28T00:27:02Z
bundlenamespacemappings.fleet.cattle.io                           2025-08-28T00:27:02Z
bundles.fleet.cattle.io                                           2025-08-28T00:26:10Z
clustergroups.fleet.cattle.io                                     2025-08-28T00:26:10Z
clusterproxyconfigs.management.cattle.io                          2025-08-28T00:26:09Z
clusterregistrations.fleet.cattle.io                              2025-08-28T00:27:02Z
clusterregistrationtokens.fleet.cattle.io                         2025-08-28T00:27:02Z
clusterregistrationtokens.management.cattle.io                    2025-08-28T00:26:10Z
clusterrepos.catalog.cattle.io                                    2025-08-28T00:26:09Z
clusterroletemplatebindings.management.cattle.io                  2025-08-28T00:26:09Z
clusters.fleet.cattle.io                                          2025-08-28T00:26:10Z
clusters.management.cattle.io                                     2025-08-28T00:26:10Z
clusters.provisioning.cattle.io                                   2025-08-28T00:26:09Z
composeconfigs.management.cattle.io                               2025-08-28T00:26:17Z
contents.fleet.cattle.io                                          2025-08-28T00:27:02Z
custommachines.rke.cattle.io                                      2025-08-28T00:26:09Z
digitaloceanconfigs.rke-machine-config.cattle.io                  2025-08-28T00:26:33Z
digitaloceanmachines.rke-machine.cattle.io                        2025-08-28T00:26:33Z
digitaloceanmachinetemplates.rke-machine.cattle.io                2025-08-28T00:26:33Z
dynamicschemas.management.cattle.io                               2025-08-28T00:26:09Z
etcdsnapshots.rke.cattle.io                                       2025-08-28T00:26:09Z
features.management.cattle.io                                     2025-08-28T00:26:06Z
fleetworkspaces.management.cattle.io                              2025-08-28T00:26:10Z
gitreporestrictions.fleet.cattle.io                               2025-08-28T00:27:02Z
gitrepos.fleet.cattle.io                                          2025-08-28T00:27:02Z
globalrolebindings.management.cattle.io                           2025-08-28T00:26:09Z
globalroles.management.cattle.io                                  2025-08-28T00:26:09Z
groupmembers.management.cattle.io                                 2025-08-28T00:26:12Z
groups.management.cattle.io                                       2025-08-28T00:26:12Z
harvesterconfigs.rke-machine-config.cattle.io                     2025-08-28T00:26:33Z
harvestermachines.rke-machine.cattle.io                           2025-08-28T00:26:33Z
harvestermachinetemplates.rke-machine.cattle.io                   2025-08-28T00:26:33Z
helmops.fleet.cattle.io                                           2025-08-28T00:27:02Z
imagescans.fleet.cattle.io                                        2025-08-28T00:27:03Z
kontainerdrivers.management.cattle.io                             2025-08-28T00:26:17Z
linodeconfigs.rke-machine-config.cattle.io                        2025-08-28T00:26:33Z
linodemachines.rke-machine.cattle.io                              2025-08-28T00:26:33Z
linodemachinetemplates.rke-machine.cattle.io                      2025-08-28T00:26:33Z
managedcharts.management.cattle.io                                2025-08-28T00:26:11Z
navlinks.ui.cattle.io                                             2025-08-28T00:26:10Z
nodedrivers.management.cattle.io                                  2025-08-28T00:26:09Z
nodepools.management.cattle.io                                    2025-08-28T00:26:17Z
nodes.management.cattle.io                                        2025-08-28T00:26:17Z
operations.catalog.cattle.io                                      2025-08-28T00:26:10Z
plans.upgrade.cattle.io                                           2025-08-28T00:26:10Z
podsecurityadmissionconfigurationtemplates.management.cattle.io   2025-08-28T00:26:10Z
preferences.management.cattle.io                                  2025-08-28T00:26:10Z
projectnetworkpolicies.management.cattle.io                       2025-08-28T00:26:17Z
projectroletemplatebindings.management.cattle.io                  2025-08-28T00:26:09Z
projects.management.cattle.io                                     2025-08-28T00:26:09Z
rancherusernotifications.management.cattle.io                     2025-08-28T00:26:17Z
rkebootstraps.rke.cattle.io                                       2025-08-28T00:26:09Z
rkebootstraptemplates.rke.cattle.io                               2025-08-28T00:26:09Z
rkeclusters.rke.cattle.io                                         2025-08-28T00:26:09Z
rkecontrolplanes.rke.cattle.io                                    2025-08-28T00:26:09Z
roletemplates.management.cattle.io                                2025-08-28T00:26:09Z
samltokens.management.cattle.io                                   2025-08-28T00:26:17Z
settings.management.cattle.io                                     2025-08-28T00:26:10Z
tokens.management.cattle.io                                       2025-08-28T00:26:12Z
uiplugins.catalog.cattle.io                                       2025-08-28T00:26:09Z
userattributes.management.cattle.io                               2025-08-28T00:26:12Z
users.management.cattle.io                                        2025-08-28T00:26:12Z
vmwarevsphereconfigs.rke-machine-config.cattle.io                 2025-08-28T00:26:33Z
vmwarevspheremachines.rke-machine.cattle.io                       2025-08-28T00:26:33Z
vmwarevspheremachinetemplates.rke-machine.cattle.io               2025-08-28T00:26:33Z
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k delete -n cattle-
cattle-fleet-clusters-system     cattle-fleet-system              cattle-impersonation-system      cattle-system                    
cattle-fleet-local-system        cattle-global-data               cattle-provisioning-capi-system  cattle-ui-plugin-system          
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k get namespaces 
NAME                                     STATUS   AGE
argocd                                   Active   6d18h
cattle-fleet-clusters-system             Active   16h
cattle-fleet-local-system                Active   16h
cattle-fleet-system                      Active   16h
cattle-global-data                       Active   16h
cattle-impersonation-system              Active   16h
cattle-provisioning-capi-system          Active   16h
cattle-system                            Active   17h
cattle-ui-plugin-system                  Active   16h
cert-manager                             Active   18d
cluster-fleet-local-local-1a3d67d0a899   Active   16h
default                                  Active   58d
fleet-default                            Active   16h
fleet-local                              Active   16h
ingress-nginx                            Active   18d
kube-node-lease                          Active   58d
kube-public                              Active   58d
kube-system                              Active   58d
local                                    Active   16h
local-path-storage                       Active   25d
monitoring                               Active   2d19h
p-bg7gk                                  Active   16h
p-pmm7s                                  Active   16h
us103-demos                              Active   16d
user-pnmfr                               Active   36m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep cattle.io | awk '{print $1}' | xargs kubectl delete crd
customresourcedefinition.apiextensions.k8s.io "amazonec2configs.rke-machine-config.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "amazonec2machines.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "amazonec2machinetemplates.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "apiservices.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "apps.catalog.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "auditpolicies.auditlog.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "authconfigs.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "azureconfigs.rke-machine-config.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "azuremachines.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "azuremachinetemplates.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "bundledeployments.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "bundlenamespacemappings.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "bundles.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clustergroups.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusterproxyconfigs.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusterregistrations.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusterregistrationtokens.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusterregistrationtokens.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusterrepos.catalog.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusterroletemplatebindings.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusters.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusters.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusters.provisioning.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "composeconfigs.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "contents.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "custommachines.rke.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "digitaloceanconfigs.rke-machine-config.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "digitaloceanmachines.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "digitaloceanmachinetemplates.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "dynamicschemas.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "etcdsnapshots.rke.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "features.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "fleetworkspaces.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "gitreporestrictions.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "gitrepos.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "globalrolebindings.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "globalroles.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "groupmembers.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "groups.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "harvesterconfigs.rke-machine-config.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "harvestermachines.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "harvestermachinetemplates.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "helmops.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "imagescans.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "kontainerdrivers.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "linodeconfigs.rke-machine-config.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "linodemachines.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "linodemachinetemplates.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "managedcharts.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "navlinks.ui.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "nodedrivers.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "nodepools.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "nodes.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "operations.catalog.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "plans.upgrade.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "podsecurityadmissionconfigurationtemplates.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "preferences.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "projectnetworkpolicies.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "projectroletemplatebindings.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "projects.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "rancherusernotifications.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "rkebootstraps.rke.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "rkebootstraptemplates.rke.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "rkeclusters.rke.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "rkecontrolplanes.rke.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "roletemplates.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "samltokens.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "settings.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "tokens.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "uiplugins.catalog.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "userattributes.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "users.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "vmwarevsphereconfigs.rke-machine-config.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "vmwarevspheremachines.rke-machine.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "vmwarevspheremachinetemplates.rke-machine.cattle.io" deleted
^C
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep cattle.io 
bundledeployments.fleet.cattle.io                     2025-08-28T00:27:02Z
bundles.fleet.cattle.io                               2025-08-28T00:26:10Z
clusterroletemplatebindings.management.cattle.io      2025-08-28T00:26:09Z
clusters.management.cattle.io                         2025-08-28T00:26:10Z
clusters.provisioning.cattle.io                       2025-08-28T00:26:09Z
contents.fleet.cattle.io                              2025-08-28T00:27:02Z
globalrolebindings.management.cattle.io               2025-08-28T00:26:09Z
globalroles.management.cattle.io                      2025-08-28T00:26:09Z
kontainerdrivers.management.cattle.io                 2025-08-28T00:26:17Z
nodedrivers.management.cattle.io                      2025-08-28T00:26:09Z
projects.management.cattle.io                         2025-08-28T00:26:09Z
roletemplates.management.cattle.io                    2025-08-28T00:26:09Z
users.management.cattle.io                            2025-08-28T00:26:12Z
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep cattle.io | awk '{print $1}' | xargs kubectl delete crd
customresourcedefinition.apiextensions.k8s.io "bundledeployments.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "bundles.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusterroletemplatebindings.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusters.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "clusters.provisioning.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "contents.fleet.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "globalrolebindings.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "globalroles.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "kontainerdrivers.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "nodedrivers.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "projects.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "roletemplates.management.cattle.io" deleted
customresourcedefinition.apiextensions.k8s.io "users.management.cattle.io" deleted
^C
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep cattle.io 
bundledeployments.fleet.cattle.io                     2025-08-28T00:27:02Z
bundles.fleet.cattle.io                               2025-08-28T00:26:10Z
clusterroletemplatebindings.management.cattle.io      2025-08-28T00:26:09Z
clusters.management.cattle.io                         2025-08-28T00:26:10Z
clusters.provisioning.cattle.io                       2025-08-28T00:26:09Z
contents.fleet.cattle.io                              2025-08-28T00:27:02Z
globalrolebindings.management.cattle.io               2025-08-28T00:26:09Z
globalroles.management.cattle.io                      2025-08-28T00:26:09Z
kontainerdrivers.management.cattle.io                 2025-08-28T00:26:17Z
nodedrivers.management.cattle.io                      2025-08-28T00:26:09Z
projects.management.cattle.io                         2025-08-28T00:26:09Z
roletemplates.management.cattle.io                    2025-08-28T00:26:09Z
users.management.cattle.io                            2025-08-28T00:26:12Z
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $# Force delete with no grace period
kubectl get crd | grep cattle.io | awk '{print $1}' | xargs -I {} kubectl delete crd {} --force --grace-period=0
Warning: Immediate deletion does not wait for confirmation that the running resource has been terminated. The resource may continue to run on the cluster indefinitely.
customresourcedefinition.apiextensions.k8s.io "bundledeployments.fleet.cattle.io" force deleted
^C
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $STUCK_CRDS=$(kubectl get crd | grep cattle.io | awk '{print $1}')
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $for crd in $STUCK_CRDS; do
  echo "Removing finalizers from $crd"
  kubectl patch crd "$crd" -p '{"metadata":{"finalizers":[]}}' --type=merge
done
Removing finalizers from bundledeployments.fleet.cattle.io
customresourcedefinition.apiextensions.k8s.io/bundledeployments.fleet.cattle.io patched
Removing finalizers from bundles.fleet.cattle.io
customresourcedefinition.apiextensions.k8s.io/bundles.fleet.cattle.io patched
Removing finalizers from clusterroletemplatebindings.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/clusterroletemplatebindings.management.cattle.io patched
Removing finalizers from clusters.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/clusters.management.cattle.io patched
Removing finalizers from clusters.provisioning.cattle.io
customresourcedefinition.apiextensions.k8s.io/clusters.provisioning.cattle.io patched
Removing finalizers from contents.fleet.cattle.io
customresourcedefinition.apiextensions.k8s.io/contents.fleet.cattle.io patched
Removing finalizers from globalrolebindings.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/globalrolebindings.management.cattle.io patched
Removing finalizers from globalroles.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/globalroles.management.cattle.io patched
Removing finalizers from kontainerdrivers.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/kontainerdrivers.management.cattle.io patched
Removing finalizers from nodedrivers.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/nodedrivers.management.cattle.io patched
Removing finalizers from projects.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/projects.management.cattle.io patched
Removing finalizers from roletemplates.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/roletemplates.management.cattle.io patched
Removing finalizers from users.management.cattle.io
customresourcedefinition.apiextensions.k8s.io/users.management.cattle.io patched
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep cattle.io | awk '{print $1}' | xargs kubectl delete crd
error: resource(s) were provided, but no name was specified
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep cattle.io
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep rancher.io 
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep fleet.cattle.io 
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep fleet.cattle.io 
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get crd | grep management.cattle.io
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $f
f: command not found
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kgp
No resources found in default namespace.
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl delete namespace cattle-system
namespace "cattle-system" deleted
^C┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl delete namespace cattle-fleet-clusters-system
kubectl delete namespace cattle-fleet-local-system  
namespace "cattle-fleet-clusters-system" deleted
^Cnamespace "cattle-fleet-local-system" deleted
  

^C┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k get namespaces
NAME                                     STATUS        AGE
argocd                                   Active        6d19h
cattle-fleet-clusters-system             Terminating   18h
cattle-fleet-local-system                Terminating   18h
cattle-fleet-system                      Active        18h
cattle-global-data                       Active        18h
cattle-impersonation-system              Active        18h
cattle-provisioning-capi-system          Active        18h
cattle-system                            Terminating   18h
cattle-ui-plugin-system                  Active        18h
cert-manager                             Active        18d
cluster-fleet-local-local-1a3d67d0a899   Active        18h
default                                  Active        58d
fleet-default                            Active        18h
fleet-local                              Active        18h
ingress-nginx                            Active        18d
kube-node-lease                          Active        58d
kube-public                              Active        58d
kube-system                              Active        58d
local                                    Active        18h
local-path-storage                       Active        25d
monitoring                               Active        2d21h
p-bg7gk                                  Active        18h
p-pmm7s                                  Active        18h
us103-demos                              Active        16d
user-pnmfr                               Active        115m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $bs
bs103shut  bsappk8    bsk8shut   bsk8start  bsorc      
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $bsk8shut
🔧 Shutting down Kubernetes cluster...
[INFO] Switching kubectl context to: 
[INFO] Cordoning node: bsus103k-8m01
[INFO] Cordoning node: bsus103k-8w01
[INFO] Cordoning node: bsus103k-8w02
[INFO] Loading optional shutdown targets from /srv/repos/infutable-infra/orchestration/us103/bin/../vars/optional/us103-start-k8s.vars
🔧 Delegating VM shutdown to: /srv/repos/infutable-infra/orchestration/us103/bin/../libexec/us103-shutdown-xo-vm.sh
🚀 Initiating shutdown for VM 'bsus103k-8m01'...
🛑 Sending shutdown for 'bsus103k-8m01' (UUID: b78ba2a5-ac4f-2db1-b8d6-0fc46c1a3c8a) on host 10.0.0.52...
🚀 Initiating shutdown for VM 'bsus103k-8w01'...
🛑 Sending shutdown for 'bsus103k-8w01' (UUID: e967306b-6cc2-c7e3-4ffe-876d29fcf26e) on host 10.0.0.52...
🚀 Initiating shutdown for VM 'bsus103k-8w02'...
🛑 Sending shutdown for 'bsus103k-8w02' (UUID: d35e8d1e-f151-98ea-fcad-56324fe7bebe) on host 10.0.0.52...
⏳ Waiting up to 180 seconds for all VMs to power off...
✅ VM 'bsus103k-8m01' is now powered off.
✅ VM 'bsus103k-8w01' is now powered off.
✅ VM 'bsus103k-8w02' is now powered off.
🎉 All VMs shut down successfully.
✅ K8s shutdown done.
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $bs
bs103shut  bsappk8    bsk8shut   bsk8start  bsorc      
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $bsk8start 
🔍 Checking DNS reachability...
📦 Starting Kubernetes VMs for context: us103-kubeadm01
➡️ Starting VM: bsus103k-8m01
📦 Starting VMs using xo-cli...
➡️  Starting VM: bsus103k-8m01
🚀 Starting bsus103k-8m01 (UUID: b78ba2a5-ac4f-2db1-b8d6-0fc46c1a3c8a)...
"/rest/v0/tasks/0mevrax6f"
✅ VM startup complete.
➡️ Starting VM: bsus103k-8w01
📦 Starting VMs using xo-cli...
➡️  Starting VM: bsus103k-8w01
🚀 Starting bsus103k-8w01 (UUID: e967306b-6cc2-c7e3-4ffe-876d29fcf26e)...
"/rest/v0/tasks/0mevraxrf"
✅ VM startup complete.
➡️ Starting VM: bsus103k-8w02
📦 Starting VMs using xo-cli...
➡️  Starting VM: bsus103k-8w02
🚀 Starting bsus103k-8w02 (UUID: d35e8d1e-f151-98ea-fcad-56324fe7bebe)...
"/rest/v0/tasks/0mevraygl"
✅ VM startup complete.
🔄 Switching kubectl to context 'us103-kubeadm01'...
Switched to context "us103-kubeadm01".
⏳ Waiting for Kubernetes API server...
🔄 API server not ready, retrying...
🔄 API server not ready, retrying...
🔄 API server not ready, retrying...
🔄 API server not ready, retrying...
🔄 API server not ready, retrying...
🔄 API server not ready, retrying...
✅ API server is available
⏳ Waiting for all nodes to be Ready...
✅ All nodes Ready (or Ready,SchedulingDisabled)
🔓 Uncordoning nodes if needed...
🔓 Uncordoning bsus103k-8m01
node/bsus103k-8m01 uncordoned
🔓 Uncordoning bsus103k-8w01
node/bsus103k-8w01 uncordoned
🔓 Uncordoning bsus103k-8w02
node/bsus103k-8w02 uncordoned
📦 Starting optional VMs from /srv/repos/infutable-infra/orchestration/us103/bin/../vars/optional/us103-start-k8s.vars
✅ All done.
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kgp
No resources found in default namespace.
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k get namespaces 
NAME                                     STATUS        AGE
argocd                                   Active        6d19h
cattle-fleet-clusters-system             Terminating   18h
cattle-fleet-local-system                Terminating   18h
cattle-fleet-system                      Active        18h
cattle-global-data                       Active        18h
cattle-impersonation-system              Active        18h
cattle-provisioning-capi-system          Active        18h
cattle-system                            Terminating   19h
cattle-ui-plugin-system                  Active        18h
cert-manager                             Active        18d
cluster-fleet-local-local-1a3d67d0a899   Active        18h
default                                  Active        58d
fleet-default                            Active        18h
fleet-local                              Active        18h
ingress-nginx                            Active        18d
kube-node-lease                          Active        58d
kube-public                              Active        58d
kube-system                              Active        58d
local                                    Active        18h
local-path-storage                       Active        25d
monitoring                               Active        2d21h
p-bg7gk                                  Active        18h
p-pmm7s                                  Active        18h
us103-demos                              Active        16d
user-pnmfr                               Active        122m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k delete namespaces cattle-
cattle-fleet-clusters-system     cattle-fleet-system              cattle-impersonation-system      cattle-system                    
cattle-fleet-local-system        cattle-global-data               cattle-provisioning-capi-system  cattle-ui-plugin-system          
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k delete namespaces cattle-system 
namespace "cattle-system" deleted
^C┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k get namespaces 
NAME                                     STATUS        AGE
argocd                                   Active        6d19h
cattle-fleet-clusters-system             Terminating   18h
cattle-fleet-local-system                Terminating   18h
cattle-fleet-system                      Active        18h
cattle-global-data                       Active        18h
cattle-impersonation-system              Active        18h
cattle-provisioning-capi-system          Active        18h
cattle-system                            Terminating   19h
cattle-ui-plugin-system                  Active        18h
cert-manager                             Active        18d
cluster-fleet-local-local-1a3d67d0a899   Active        18h
default                                  Active        58d
fleet-default                            Active        18h
fleet-local                              Active        18h
ingress-nginx                            Active        18d
kube-node-lease                          Active        58d
kube-public                              Active        58d
kube-system                              Active        58d
local                                    Active        18h
local-path-storage                       Active        25d
monitoring                               Active        2d21h
p-bg7gk                                  Active        18h
p-pmm7s                                  Active        18h
us103-demos                              Active        16d
user-pnmfr                               Active        123m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl patch namespace cattle-system -p '{"metadata":{"finalizers":[]}}' --type=merge
namespace/cattle-system patched
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k get namespaces 
NAME                                     STATUS        AGE
argocd                                   Active        6d19h
cattle-fleet-clusters-system             Terminating   18h
cattle-fleet-local-system                Terminating   18h
cattle-fleet-system                      Active        18h
cattle-global-data                       Active        18h
cattle-impersonation-system              Active        18h
cattle-provisioning-capi-system          Active        18h
cattle-system                            Terminating   19h
cattle-ui-plugin-system                  Active        18h
cert-manager                             Active        18d
cluster-fleet-local-local-1a3d67d0a899   Active        18h
default                                  Active        58d
fleet-default                            Active        18h
fleet-local                              Active        18h
ingress-nginx                            Active        18d
kube-node-lease                          Active        58d
kube-public                              Active        58d
kube-system                              Active        58d
local                                    Active        18h
local-path-storage                       Active        25d
monitoring                               Active        2d21h
p-bg7gk                                  Active        18h
p-pmm7s                                  Active        18h
us103-demos                              Active        16d
user-pnmfr                               Active        124m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k delete namespaces cattle-system 
namespace "cattle-system" deleted
^C┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $k get namespace
NAME                                     STATUS        AGE
argocd                                   Active        6d19h
cattle-fleet-clusters-system             Terminating   18h
cattle-fleet-local-system                Terminating   18h
cattle-fleet-system                      Active        18h
cattle-global-data                       Active        18h
cattle-impersonation-system              Active        18h
cattle-provisioning-capi-system          Active        18h
cattle-system                            Terminating   19h
cattle-ui-plugin-system                  Active        18h
cert-manager                             Active        18d
cluster-fleet-local-local-1a3d67d0a899   Active        18h
default                                  Active        58d
fleet-default                            Active        18h
fleet-local                              Active        18h
ingress-nginx                            Active        18d
kube-node-lease                          Active        58d
kube-public                              Active        58d
kube-system                              Active        58d
local                                    Active        18h
local-path-storage                       Active        25d
monitoring                               Active        2d21h
p-bg7gk                                  Active        18h
p-pmm7s                                  Active        18h
us103-demos                              Active        16d
user-pnmfr                               Active        125m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $helm list -A | grep rancher
rancher-provisioning-capi	cattle-provisioning-capi-system	1       	2025-08-28 00:28:25.301542913 +0000 UTC	deployed	rancher-provisioning-capi-107.0.0+up0.8.0	1.10.2     
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $# Uninstall the CAPI provisioning component
helm uninstall rancher-provisioning-capi -n cattle-provisioning-capi-system --no-hooks
release "rancher-provisioning-capi" uninstalled
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $helm list -A | grep rancher
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $# Look for any other rancher-related releases
helm list -A | grep -E "(rancher|cattle|fleet)"
fleet        	cattle-fleet-system	3       	2025-08-28 16:49:43.387312577 +0000 UTC	deployed	fleet-107.0.0+up0.13.0      	0.13.0     
fleet-crd    	cattle-fleet-system	1       	2025-08-28 00:27:02.027013006 +0000 UTC	deployed	fleet-crd-107.0.0+up0.13.0  	0.13.0     
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $helm uninstall fleet -n cattle-fleet-system --no-hooks
release "fleet" uninstalled
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $helm uninstall fleet-crd -n cattle-fleet-system --no-hooks
release "fleet-crd" uninstalled
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $helm list -A | grep -E "(cattle|fleet|rancher|local|p-)"
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $kubectl get ns | grep Terminating
cattle-fleet-clusters-system             Terminating   18h
cattle-fleet-local-system                Terminating   18h
cattle-system                            Terminating   19h
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[~]
└──╼ $bsappk8 
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s]
└──╼ $ll
total 20
drwxrwsr-x 5 bryan gitadmins 4096 Aug 22 17:02 ./
drwxrwsr-x 7 bryan gitadmins 4096 Aug 21 20:03 ../
drwxrwsr-x 3 bryan gitadmins 4096 Aug 12 18:04 apps/
drwxrwsr-x 5 bryan gitadmins 4096 Aug 27 16:58 apps-legacy/
drwxrwsr-x 5 bryan gitadmins 4096 Aug 27 19:23 platform/
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s]
└──╼ $cd platform/
monitoring/ namespaces/ rancher/    
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s]
└──╼ $cd platform/rancher/removal/
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $ll
total 12
drwxrwsr-x 2 bryan gitadmins 4096 Aug 28 15:16 ./
drwxrwsr-x 7 bryan gitadmins 4096 Aug 28 15:16 ../
-rw-rw-r-- 1 bryan gitadmins  758 Aug 28 15:16 force-cleanup-namespaces.sh
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $chmod +x force-cleanup-namespaces.sh 
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $./force-cleanup-namespaces.sh 
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $k get namespaces
NAME                                     STATUS        AGE
argocd                                   Active        6d20h
cattle-fleet-clusters-system             Terminating   18h
cattle-fleet-local-system                Terminating   18h
cattle-fleet-system                      Active        18h
cattle-global-data                       Active        18h
cattle-impersonation-system              Active        18h
cattle-provisioning-capi-system          Active        18h
cattle-system                            Terminating   19h
cattle-ui-plugin-system                  Active        18h
cert-manager                             Active        18d
cluster-fleet-local-local-1a3d67d0a899   Active        18h
default                                  Active        58d
fleet-default                            Active        18h
fleet-local                              Active        18h
ingress-nginx                            Active        18d
kube-node-lease                          Active        58d
kube-public                              Active        58d
kube-system                              Active        58d
local                                    Active        18h
local-path-storage                       Active        25d
monitoring                               Active        2d21h
p-bg7gk                                  Active        18h
p-pmm7s                                  Active        18h
us103-demos                              Active        16d
user-pnmfr                               Active        147m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $cat force-cleanup-namespaces.sh 
#!/bin/bash

# Get all terminating namespaces
TERMINATING_NS=$(kubectl get ns | grep Terminating | awk '{print $1}')

for ns in $TERMINATING_NS; do
  echo "Force cleaning namespace: $ns"
  
  # Method 1: Remove finalizers via API
  kubectl get namespace $ns -o json | \
    jq '.spec.finalizers = []' | \
    kubectl replace --raw "/api/v1/namespaces/$ns/finalize" -f -
  
  # If still stuck, try method 2: Patch directly
  kubectl patch namespace $ns -p '{"metadata":{"finalizers":null}}' --type=merge
  
  # Check status
  kubectl get ns $ns 2>/dev/null || echo "Namespace $ns deleted successfully"
done
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $./force-cleanup-namespaces.sh 
Force cleaning namespace: cattle-fleet-clusters-system
{"kind":"Namespace","apiVersion":"v1","metadata":{"name":"cattle-fleet-clusters-system","uid":"8856208b-5b74-49f4-817f-9b92cce02cc9","resourceVersion":"1549605","creationTimestamp":"2025-08-28T00:27:33Z","deletionTimestamp":"2025-08-28T18:43:24Z","labels":{"field.cattle.io/projectId":"p-bg7gk","kubernetes.io/metadata.name":"cattle-fleet-clusters-system","objectset.rio.cattle.io/hash":"4510303f19b6cbafc9031148b1866f16c2be7aaa"},"annotations":{"cattle.io/status":"{\"Conditions\":[{\"Type\":\"ResourceQuotaInit\",\"Status\":\"True\",\"Message\":\"\",\"LastUpdateTime\":\"2025-08-28T00:27:34Z\"},{\"Type\":\"InitialRolesPopulated\",\"Status\":\"True\",\"Message\":\"\",\"LastUpdateTime\":\"2025-08-28T00:27:39Z\"}]}","field.cattle.io/projectId":"local:p-bg7gk","lifecycle.cattle.io/create.namespace-auth":"true","management.cattle.io/no-default-sa-token":"true","objectset.rio.cattle.io/applied":"H4sIAAAAAAAA/3zOTW6DQAyG4bt4HShTUprMOXoBj2OUqeYH4Y9Fhbh7NWSfnS1Zj9+dsoIfDCa/E5dSwYi1WFtr+FWBKfo11l4YSNrH+hEf5GlOquhCrTCsvHSncVxIVj2Fn5jVwHkhX7aULpQ4aHrrPtme5On65YZxGGd3D5MEnuU+jM5db8Hdpml2k3wG/WY+vxXOSp5eRvdqkrQZdLXO/gya25ktKuT3NoGxtYrj+A8AAP//GNBA4fwAAAA","objectset.rio.cattle.io/id":"fleet-bootstrap-data"},"finalizers":["controller.cattle.io/namespace-auth"],"managedFields":[{"manager":"fleetcontroller","operation":"Update","apiVersion":"v1","time":"2025-08-28T00:27:33Z","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:objectset.rio.cattle.io/applied":{},"f:objectset.rio.cattle.io/id":{}},"f:labels":{".":{},"f:kubernetes.io/metadata.name":{},"f:objectset.rio.cattle.io/hash":{}}}}},{"manager":"rancher","operation":"Update","apiVersion":"v1","time":"2025-08-28T00:27:38Z","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{"f:cattle.io/status":{},"f:field.cattle.io/projectId":{},"f:lifecycle.cattle.io/create.namespace-auth":{},"f:management.cattle.io/no-default-sa-token":{}},"f:finalizers":{".":{},"v:\"controller.cattle.io/namespace-auth\"":{}},"f:labels":{"f:field.cattle.io/projectId":{}}}}},{"manager":"kube-controller-manager","operation":"Update","apiVersion":"v1","time":"2025-08-28T18:43:29Z","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:conditions":{".":{},"k:{\"type\":\"NamespaceContentRemaining\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionContentFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionDiscoveryFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionGroupVersionParsingFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceFinalizersRemaining\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}}}}},"subresource":"status"}]},"spec":{},"status":{"phase":"Terminating","conditions":[{"type":"NamespaceDeletionDiscoveryFailure","status":"True","lastTransitionTime":"2025-08-28T18:43:29Z","reason":"DiscoveryFailed","message":"Discovery failed for some groups, 1 failing: unable to retrieve the complete list of server APIs: ext.cattle.io/v1: stale GroupVersion discovery: ext.cattle.io/v1"},{"type":"NamespaceDeletionGroupVersionParsingFailure","status":"False","lastTransitionTime":"2025-08-28T18:43:29Z","reason":"ParsedGroupVersions","message":"All legacy kube types successfully parsed"},{"type":"NamespaceDeletionContentFailure","status":"False","lastTransitionTime":"2025-08-28T18:43:29Z","reason":"ContentDeleted","message":"All content successfully deleted, may be waiting on finalization"},{"type":"NamespaceContentRemaining","status":"False","lastTransitionTime":"2025-08-28T18:43:29Z","reason":"ContentRemoved","message":"All content successfully removed"},{"type":"NamespaceFinalizersRemaining","status":"False","lastTransitionTime":"2025-08-28T18:43:29Z","reason":"ContentHasNoFinalizers","message":"All content-preserving finalizers finished"}]}}
namespace/cattle-fleet-clusters-system patched
Namespace cattle-fleet-clusters-system deleted successfully
Force cleaning namespace: cattle-fleet-local-system
{"kind":"Namespace","apiVersion":"v1","metadata":{"name":"cattle-fleet-local-system","uid":"c327790f-d0dc-493d-9c92-fc914654f1a6","resourceVersion":"1549607","creationTimestamp":"2025-08-28T00:27:40Z","deletionTimestamp":"2025-08-28T18:44:55Z","labels":{"field.cattle.io/projectId":"p-bg7gk","kubernetes.io/metadata.name":"cattle-fleet-local-system","objectset.rio.cattle.io/hash":"362023f752e7f1989d8b652e029bd2c658ae7c44"},"annotations":{"cattle.io/status":"{\"Conditions\":[{\"Type\":\"ResourceQuotaInit\",\"Status\":\"True\",\"Message\":\"\",\"LastUpdateTime\":\"2025-08-28T00:27:41Z\"},{\"Type\":\"InitialRolesPopulated\",\"Status\":\"True\",\"Message\":\"\",\"LastUpdateTime\":\"2025-08-28T00:27:46Z\"}]}","field.cattle.io/projectId":"local:p-bg7gk","lifecycle.cattle.io/create.namespace-auth":"true","management.cattle.io/no-default-sa-token":"true","objectset.rio.cattle.io/applied":"H4sIAAAAAAAA/3yOS27DMAxE78J15KZK/NM5egFKphsV+hjmZFEYvnuhZp8diRnMewdlAS8MJncQl1LBiLVoe6v/kQAVdHusXWAgSRfrR1zI0ZpEYPhbCoyvFYqdN/MqmVeYauBk9Fchmc4LhV3+x79iFgXnjVx5pnShxF7SW+SD9UGOboO92ts69lbG9XOe5mXyQ2/lame/2DD0E8sY7vdGK5yFHL010k0CuaNdYDybwnn+BQAA//+dOVY4FAEAAA","objectset.rio.cattle.io/id":"fleet-agent-bootstrap-cattle-fleet-local-system"},"finalizers":["controller.cattle.io/namespace-auth"],"managedFields":[{"manager":"fleetcontroller","operation":"Update","apiVersion":"v1","time":"2025-08-28T00:27:40Z","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:objectset.rio.cattle.io/applied":{},"f:objectset.rio.cattle.io/id":{}},"f:labels":{".":{},"f:kubernetes.io/metadata.name":{},"f:objectset.rio.cattle.io/hash":{}}}}},{"manager":"rancher","operation":"Update","apiVersion":"v1","time":"2025-08-28T00:27:45Z","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{"f:cattle.io/status":{},"f:field.cattle.io/projectId":{},"f:lifecycle.cattle.io/create.namespace-auth":{},"f:management.cattle.io/no-default-sa-token":{}},"f:finalizers":{".":{},"v:\"controller.cattle.io/namespace-auth\"":{}},"f:labels":{"f:field.cattle.io/projectId":{}}}}},{"manager":"kube-controller-manager","operation":"Update","apiVersion":"v1","time":"2025-08-28T18:45:02Z","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:conditions":{".":{},"k:{\"type\":\"NamespaceContentRemaining\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionContentFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionDiscoveryFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionGroupVersionParsingFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceFinalizersRemaining\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}}}}},"subresource":"status"}]},"spec":{},"status":{"phase":"Terminating","conditions":[{"type":"NamespaceDeletionDiscoveryFailure","status":"True","lastTransitionTime":"2025-08-28T18:45:00Z","reason":"DiscoveryFailed","message":"Discovery failed for some groups, 1 failing: unable to retrieve the complete list of server APIs: ext.cattle.io/v1: stale GroupVersion discovery: ext.cattle.io/v1"},{"type":"NamespaceDeletionGroupVersionParsingFailure","status":"False","lastTransitionTime":"2025-08-28T18:45:00Z","reason":"ParsedGroupVersions","message":"All legacy kube types successfully parsed"},{"type":"NamespaceDeletionContentFailure","status":"False","lastTransitionTime":"2025-08-28T18:45:02Z","reason":"ContentDeleted","message":"All content successfully deleted, may be waiting on finalization"},{"type":"NamespaceContentRemaining","status":"False","lastTransitionTime":"2025-08-28T18:45:00Z","reason":"ContentRemoved","message":"All content successfully removed"},{"type":"NamespaceFinalizersRemaining","status":"False","lastTransitionTime":"2025-08-28T18:45:00Z","reason":"ContentHasNoFinalizers","message":"All content-preserving finalizers finished"}]}}
namespace/cattle-fleet-local-system patched
Namespace cattle-fleet-local-system deleted successfully
Force cleaning namespace: cattle-system
{"kind":"Namespace","apiVersion":"v1","metadata":{"name":"cattle-system","uid":"2dd181e1-f1cd-4200-999a-f1d756edb764","resourceVersion":"1546447","creationTimestamp":"2025-08-27T23:51:39Z","deletionTimestamp":"2025-08-28T18:30:49Z","labels":{"field.cattle.io/projectId":"p-bg7gk","kubernetes.io/metadata.name":"cattle-system"},"annotations":{"cattle.io/status":"{\"Conditions\":[{\"Type\":\"ResourceQuotaInit\",\"Status\":\"True\",\"Message\":\"\",\"LastUpdateTime\":\"2025-08-28T00:26:37Z\"},{\"Type\":\"InitialRolesPopulated\",\"Status\":\"True\",\"Message\":\"\",\"LastUpdateTime\":\"2025-08-28T00:26:42Z\"}]}","field.cattle.io/projectId":"local:p-bg7gk","lifecycle.cattle.io/create.namespace-auth":"true","management.cattle.io/no-default-sa-token":"true"},"managedFields":[{"manager":"kubectl-create","operation":"Update","apiVersion":"v1","time":"2025-08-27T23:51:39Z","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:labels":{".":{},"f:kubernetes.io/metadata.name":{}}}}},{"manager":"rancher","operation":"Update","apiVersion":"v1","time":"2025-08-28T00:26:41Z","fieldsType":"FieldsV1","fieldsV1":{"f:metadata":{"f:annotations":{".":{},"f:cattle.io/status":{},"f:field.cattle.io/projectId":{},"f:lifecycle.cattle.io/create.namespace-auth":{},"f:management.cattle.io/no-default-sa-token":{}},"f:labels":{"f:field.cattle.io/projectId":{}}}}},{"manager":"kube-controller-manager","operation":"Update","apiVersion":"v1","time":"2025-08-28T18:30:54Z","fieldsType":"FieldsV1","fieldsV1":{"f:status":{"f:conditions":{".":{},"k:{\"type\":\"NamespaceContentRemaining\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionContentFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionDiscoveryFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceDeletionGroupVersionParsingFailure\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}},"k:{\"type\":\"NamespaceFinalizersRemaining\"}":{".":{},"f:lastTransitionTime":{},"f:message":{},"f:reason":{},"f:status":{},"f:type":{}}}}},"subresource":"status"}]},"spec":{},"status":{"phase":"Terminating","conditions":[{"type":"NamespaceDeletionDiscoveryFailure","status":"True","lastTransitionTime":"2025-08-28T18:30:54Z","reason":"DiscoveryFailed","message":"Discovery failed for some groups, 1 failing: unable to retrieve the complete list of server APIs: ext.cattle.io/v1: stale GroupVersion discovery: ext.cattle.io/v1"},{"type":"NamespaceDeletionGroupVersionParsingFailure","status":"False","lastTransitionTime":"2025-08-28T18:30:54Z","reason":"ParsedGroupVersions","message":"All legacy kube types successfully parsed"},{"type":"NamespaceDeletionContentFailure","status":"False","lastTransitionTime":"2025-08-28T18:30:54Z","reason":"ContentDeleted","message":"All content successfully deleted, may be waiting on finalization"},{"type":"NamespaceContentRemaining","status":"False","lastTransitionTime":"2025-08-28T18:30:54Z","reason":"ContentRemoved","message":"All content successfully removed"},{"type":"NamespaceFinalizersRemaining","status":"False","lastTransitionTime":"2025-08-28T18:30:54Z","reason":"ContentHasNoFinalizers","message":"All content-preserving finalizers finished"}]}}
Error from server (NotFound): namespaces "cattle-system" not found
Namespace cattle-system deleted successfully
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $k get namespaces 
NAME                                     STATUS   AGE
argocd                                   Active   6d20h
cattle-fleet-system                      Active   18h
cattle-global-data                       Active   18h
cattle-impersonation-system              Active   18h
cattle-provisioning-capi-system          Active   18h
cattle-ui-plugin-system                  Active   18h
cert-manager                             Active   18d
cluster-fleet-local-local-1a3d67d0a899   Active   18h
default                                  Active   58d
fleet-default                            Active   18h
fleet-local                              Active   18h
ingress-nginx                            Active   18d
kube-node-lease                          Active   58d
kube-public                              Active   58d
kube-system                              Active   58d
local                                    Active   18h
local-path-storage                       Active   25d
monitoring                               Active   2d21h
p-bg7gk                                  Active   18h
p-pmm7s                                  Active   18h
us103-demos                              Active   16d
user-pnmfr                               Active   148m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $# Fleet leaves behind specific CRDs
kubectl get crd | grep fleet.cattle.io
kubectl get crd | grep fleet.cattle.io | awk '{print $1}' | xargs kubectl patch crd -p '{"metadata":{"finalizers":[]}}' --type=merge
kubectl get crd | grep fleet.cattle.io | awk '{print $1}' | xargs kubectl delete crd --force --grace-period=0
error: resource(s) were provided, but no name was specified
error: resource(s) were provided, but no name was specified
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $# Fleet leaves behind specific CRDs
kubectl get crd | grep fleet.cattle.io
kubectl get crd | grep fleet.cattle.io | awk '{print $1}' | xargs kubectl patch crd -p '{"metadata":{"finalizers":[]}}' --type=merge
kubectl get crd | grep fleet.cattle.io | awk '{print $1}' | xargs kubectl delete crd --force --grace-period=0^C
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $kubectl get crd | grep -E "cattle.io|rancher.io" | awk '{print $1}' > rancher-crds.txt
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $while read crd; do
  echo "Removing CRD: $crd"
  kubectl patch crd $crd -p '{"metadata":{"finalizers":[]}}' --type=merge
  kubectl delete crd $crd --force --grace-period=0
done < rancher-crds.txt
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $rm rancher-crds.txt
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $^[[200~helm list -A | grep -E "(rancher|cattle|fleet)"~^C
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $helm list -A | grep -E "(rancher|cattle|fleet)"
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $kubectl get ns | grep -E "(cattle|fleet|rancher)"
cattle-fleet-system                      Active   18h
cattle-global-data                       Active   18h
cattle-impersonation-system              Active   18h
cattle-provisioning-capi-system          Active   18h
cattle-ui-plugin-system                  Active   18h
cluster-fleet-local-local-1a3d67d0a899   Active   18h
fleet-default                            Active   18h
fleet-local                              Active   18h
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $kubectl get crd | grep -E "cattle.io|rancher.io"
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $kubectl get pods -n monitoring
NAME                                                     READY   STATUS    RESTARTS       AGE
alertmanager-monitoring-kube-prometheus-alertmanager-0   2/2     Running   8 (33m ago)    2d21h
monitoring-grafana-798d5b8957-m7zcs                      3/3     Running   12 (33m ago)   2d19h
monitoring-kube-prometheus-operator-6c7487c457-zc78h     1/1     Running   4 (33m ago)    2d21h
monitoring-kube-state-metrics-69dcd947d6-qfw7j           1/1     Running   4 (33m ago)    2d21h
monitoring-prometheus-node-exporter-2bw9q                1/1     Running   4 (33m ago)    2d21h
monitoring-prometheus-node-exporter-hc9l2                1/1     Running   4 (33m ago)    2d21h
monitoring-prometheus-node-exporter-hsz6k                1/1     Running   4 (33m ago)    2d21h
prometheus-monitoring-kube-prometheus-prometheus-0       2/2     Running   8 (33m ago)    2d21h
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $kubectl get pods -n argocd
NAME                                                READY   STATUS    RESTARTS       AGE
argocd-application-controller-0                     1/1     Running   10 (33m ago)   6d20h
argocd-applicationset-controller-6ff6f74bc9-4kmqm   1/1     Running   10 (33m ago)   6d20h
argocd-dex-server-558dc4bd7b-jn4k2                  1/1     Running   10 (33m ago)   6d20h
argocd-notifications-controller-9977b5bd6-7527t     1/1     Running   10 (33m ago)   6d20h
argocd-redis-6594484976-hr6ck                       1/1     Running   10 (33m ago)   6d20h
argocd-repo-server-845d4f5c49-h975s                 1/1     Running   10 (33m ago)   6d20h
argocd-server-59dd848587-4fjz5                      1/1     Running   10 (33m ago)   6d20h
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $# These namespaces are purely Rancher-related and safe to delete
RANCHER_NS="cattle-fleet-system cattle-global-data cattle-impersonation-system \
  cattle-provisioning-capi-system cattle-ui-plugin-system \
  cluster-fleet-local-local-1a3d67d0a899 fleet-default fleet-local"

# Check what's in them first (should be empty or minimal)
for ns in $RANCHER_NS; do
  echo "=== Checking $ns ==="
  kubectl get all -n $ns 2>/dev/null
done

# If they're empty or only have Rancher stuff, delete them
for ns in $RANCHER_NS; do
  kubectl delete namespace $ns --grace-period=30
done
=== Checking cattle-fleet-system ===
=== Checking cattle-global-data ===
=== Checking cattle-impersonation-system ===
=== Checking cattle-provisioning-capi-system ===
=== Checking cattle-ui-plugin-system ===
=== Checking cluster-fleet-local-local-1a3d67d0a899 ===
=== Checking fleet-default ===
NAME                                               SCHEDULE    TIMEZONE   SUSPEND   ACTIVE   LAST SCHEDULE   AGE
cronjob.batch/rke2-machineconfig-cleanup-cronjob   5 0 * * *   <none>     False     0        <none>          18h
=== Checking fleet-local ===
namespace "cattle-fleet-system" deleted
^Cnamespace "cattle-global-data" deleted
^Cnamespace "cattle-impersonation-system" deleted
^Cnamespace "cattle-provisioning-capi-system" deleted
^Cnamespace "cattle-ui-plugin-system" deleted
^Cnamespace "cluster-fleet-local-local-1a3d67d0a899" deleted
^Cnamespace "fleet-default" deleted
^Cnamespace "fleet-local" deleted
^C┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $^C
┌─[✗]─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $k get namespace
NAME                                     STATUS        AGE
argocd                                   Active        6d23h
cattle-fleet-system                      Terminating   21h
cattle-global-data                       Terminating   21h
cattle-impersonation-system              Terminating   21h
cattle-provisioning-capi-system          Terminating   21h
cattle-ui-plugin-system                  Terminating   21h
cert-manager                             Active        18d
cluster-fleet-local-local-1a3d67d0a899   Terminating   21h
default                                  Active        58d
fleet-default                            Terminating   21h
fleet-local                              Terminating   21h
ingress-nginx                            Active        18d
kube-node-lease                          Active        58d
kube-public                              Active        58d
kube-system                              Active        58d
local                                    Active        21h
local-path-storage                       Active        26d
monitoring                               Active        3d
p-bg7gk                                  Active        21h
p-pmm7s                                  Active        21h
us103-demos                              Active        16d
user-pnmfr                               Active        5h34m
┌─[bryan@bsus103jump01:{us103-kubeadm01}]─[/srv/repos/infutable-infra/k8s/platform/rancher/removal]
└──╼ $
```
